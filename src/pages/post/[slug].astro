---
import { createClient } from '@supabase/supabase-js';
import { marked } from 'marked'; // <--- 1. Importamos el traductor

export async function getStaticPaths() {
  const supabaseUrl = import.meta.env.PUBLIC_SUPABASE_URL;
  const supabaseKey = import.meta.env.PUBLIC_SUPABASE_ANON_KEY;
  const supabase = createClient(supabaseUrl, supabaseKey);

  const { data: posts } = await supabase.from('posts').select('*');

  return posts.map((noticia) => ({
    params: { slug: noticia.slug },
    props: { noticia },
  }));
}

const { noticia } = Astro.props;

// 2. Convertimos el Markdown a HTML
const contenidoHTML = marked.parse(noticia.content);
---

<html lang="es">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width" />
    <title>{noticia.title}</title>
  </head>
  <body class="bg-slate-100 font-sans">
    
    <div class="max-w-3xl mx-auto p-4 py-12">
      <a href="/" class="text-blue-600 hover:underline mb-8 inline-block">‚Üê Volver al inicio</a>

      <article class="bg-white p-8 rounded-lg shadow-lg">
        <h1 class="text-4xl font-bold text-slate-900 mb-6 leading-tight">
          {noticia.title}
        </h1>

        <div class="text-sm text-slate-500 mb-8 border-b pb-4">
          Publicado el: {new Date(noticia.created_at).toLocaleDateString()}
        </div>

        <div 
          class="prose prose-lg text-slate-700 max-w-none"
          set:html={contenidoHTML} 
        />
          
      </article>
    </div>

  </body>
</html>